var BoPattern=function(){"use strict";var a=[],b=function(b,c){var d={label:"Pattern of Life",objects:{background:[],foreground:[],overlay:[]},debug:!1,user:{mousePosition:{x:0,y:0}},data:{},eventHandlers:{},utils:{},config:msngr.merge({warnings:!0,screen:{ratio:void 0},tooltip:{display:!0}},c)};if("undefined"==typeof window||"undefined"==typeof window.HTMLCanvasElement)throw"[BoPattern.js] Sorry but your browser doesn't support the canvas element!";if(!msngr.exist(b)||msngr.isEmptyString(b))throw"[BoPattern.js] Sorry but you supplied me with invalid input! What do you expect me to do with that!?";switch(msngr.getType(b)){case"[object String]":var e=msngr.findElement(b);"[object HTMLCanvasElement]"!==msngr.getType(e)?(d.canvas=document.createElement("canvas"),e.appendChild(d.canvas)):d.canvas=e;break;case"[object HTMLCanvasElement]":d.canvas=b;break;default:if(!msngr.isHtmlElement(b))throw"[BoPattern.js] Sorry but you supplied me with invalid input! What do you expect me to do with that!?";d.canvas=document.createElement("canvas"),b.appendChild(d.canvas)}if(d.context2D=d.canvas.getContext("2d"),Object.defineProperty(d,"pxRatio",{get:function(){var a=window.devicePixelRatio||1,b=d.context2D.backingStorePixelRatio||d.context2D.webkitBackingStorePixelRatio||d.context2D.mozBackingStorePixelRatio||d.context2D.msBackingStorePixelRatio||d.context2D.oBackingStorePixelRatio||1;return a/b}}),!msngr.exist(d.canvas)||!msngr.exist(d.context2D))throw"[BoPattern.js] Welp you passed the first set of validators but I still failed to get the canvas :(";d.parent=d.canvas.parentNode,Object.defineProperty(d,"zlevels",{get:function(){return Object.keys(d.objects)}}),d.random=function(a,b){return Math.random()*(b-a)+a},d.addObject=function(a,b){msngr.exist(b)&&msngr.exist(b.render)&&d.objects[a].push(b)},d.clearObjects=function(a,b){for(var c=0;c<d.objects[a].length;++c)(void 0===b||d.objects[a][c].type===b)&&d.objects[a][c].unload()};var f={};d.trigger=function(a,b){if(d.eventHandlers[a]&&d.eventHandlers[a].length>0)for(var c=0;c<d.eventHandlers[a].length;++c)d.eventHandlers[a][c](b)},d.on=function(a,b){void 0===d.eventHandlers[a]&&(d.eventHandlers[a]=[]),d.eventHandlers[a].push(b)},f.on=d.on,d.off=function(a,b){void 0!==d.eventHandlers[a]&&d.eventHandlers[a].splice(d.eventHandlers[a].indexOf(b),1)},f.off=d.off;for(var g=0;g<a.length;++g){var h=a[g];"[object Function]"===Object.prototype.toString.call(h)&&(h=h(d)),f=msngr.merge(h,f)}return Object.defineProperty(f,"debug",{set:function(a){d.debug=a,a===!0&&(d.clearObjects("overlay","bodebug"),d.addObject("overlay",d.BoDebug()),Object.defineProperty(f,"internal",{configurable:!0,get:function(){return d}})),a===!1&&(d.clearObjects("overlay","bodebug"),delete f.internal)},get:function(){return d.debug}}),Object.defineProperty(f,"label",{get:function(){return d.label},set:function(a){d.label=a}}),Object.defineProperty(f,"config",{get:function(){return d.config},set:function(a){d.config=msngr.merge(d.config,a),d.trigger("configChanged",d.config)}}),d.addObject("overlay",d.BoEmpty()),d.addObject("overlay",d.BoTitle()),f.removeSelf=function(){d.clearObjects("background"),d.clearObjects("foreground"),d.clearObjects("overlay"),d.stopUpdating(),d.stopRendering(),delete f.load,d.parent.removeChild(d.canvas)},f};return b.extend=function(b){a.push(b)},b}();BoPattern.extend(function(a){"use strict";var b,c=function(b,c){for(var d=a.objects[b].length,e=0;d>e;++e)a.objects[b][e]&&(c.beginPath(),a.objects[b][e].render(c),c.closePath())},d=function(){var e=a.context2D;e.clearRect(0,0,a.canvas.width,a.canvas.height),c("background",e),c("foreground",e),c("overlay",e),b=window.requestAnimationFrame(d)};a.startRendering=function(){d()},a.stopRendering=function(){(window.cancelAnimationFrame||window.mozCancelAnimationFrame)(b)},document.addEventListener("visibilitychange",function(b){document.hidden?a.stopRendering():a.startRendering()}),a.startRendering()}),BoPattern.extend(function(a){"use strict";var b=function(b,c){for(var d=a.objects[b].length,e=0;d>e;++e)a.objects[b][e]&&a.objects[b][e].update(c)};a.canvas.addEventListener("mousemove",function(b){var c=a.canvas.getBoundingClientRect();a.user.mousePosition={x:b.clientX-c.left,y:b.clientY-c.top}});var c,d=function(){var e=a.context2D,f=a.pxRatio,g=a.parent.getBoundingClientRect().width,h=a.parent.getBoundingClientRect().height;void 0!==a.config.screen.ratio&&(h=g/a.config.screen.ratio),(a.screenWidth!==g||a.screenHeight!==h)&&(a.canvas.width=g*f,a.canvas.style.width=g+"px",a.screenWidth=g,a.canvas.height=h*f,a.canvas.style.height=h+"px",a.screenHeight=h,e.setTransform(f,0,0,f,0,0),a.boundedWidth=a.screenWidth-.15*a.screenWidth,a.boundedHeight=a.screenHeight-.2*a.screenHeight,a.boundedX1=(a.screenWidth-a.boundedWidth)/2,a.boundedY1=(a.screenHeight-a.boundedHeight)/2+(a.screenHeight-a.boundedHeight)/2/2,a.absoluteLeft=a.canvas.getBoundingClientRect().left,a.absoluteTop=a.canvas.getBoundingClientRect().top),b("background",e),b("foreground",e),b("overlay",e),c=window.requestAnimationFrame(d)};a.startUpdating=function(){d()},a.stopUpdating=function(){(window.cancelAnimationFrame||window.mozCancelAnimationFrame)(c)},a.startUpdating()}),BoPattern.extend(function(a){"use strict";return a.BoDebug=function(){var b="overlay",c={mouse:{},tiles:{},data:{}},d=!1,e={type:"bodebug",render:function(b){d&&(b.beginPath(),b.font=a.BoDebug.properties.font,b.fillStyle=a.BoDebug.properties.color,b.globalAlpha=a.BoDebug.properties.textAlpha,b.textAlign="left",b.fillText(c.tiles.txt,c.tiles.x,c.tiles.y),b.fillText(c.data.txt,c.data.x,c.data.y),b.textAlign="center",b.fillText(c.mouse.txt,c.mouse.x,c.mouse.y),b.closePath()),b.beginPath(),b.strokeStyle=a.BoDebug.properties.borderColor,b.globalAlpha=a.BoDebug.properties.borderAlpha,b.lineWidth=a.BoDebug.properties.borderThickness,b.strokeRect(a.boundedX1,a.boundedY1,a.boundedWidth,a.boundedHeight),b.closePath()},update:function(b){c.mouse.txt="X: "+Math.floor(a.user.mousePosition.x)+" Y: "+Math.floor(a.user.mousePosition.y);var e=b.measureText(c.mouse.txt);c.mouse.x=a.screenWidth-e.width,c.mouse.y=15,c.tiles.txt="Tile count: "+a.objects.background.length,c.tiles.x=2,c.tiles.y=15,c.data.txt="min value: "+Math.round(a.data.minValue)+" / max value: "+Math.round(a.data.maxValue),c.data.x=2,c.data.y=30,d=!0},load:function(){},unload:function(){a.objects[b].splice(a.objects[b].indexOf(e),1)}};return e},a.BoDebug.properties={font:"10pt Sans-serif",color:"#000000",textAlpha:1,borderColor:"#000000",borderAlpha:1,borderThickness:1},{}}),BoPattern.extend(function(a){"use strict";return a.BoEmpty=function(){var b,c,d,e="overlay",f="I have no data to display :(",g={type:"boempty",render:function(b){c&&d&&(b.font=a.BoEmpty.properties.font,b.textAlign="left",b.fillStyle=a.BoEmpty.properties.color,b.fillText(f,c,d))},update:function(e){b=e.measureText(f),c=a.screenWidth/2-b.width/2,d=a.screenHeight/2-14},load:function(){},unload:function(){a.objects[e].splice(a.objects[e].indexOf(g),1)}};return Object.defineProperty(g,"z",{get:function(){return z}}),g},a.BoEmpty.properties={font:"24px Gotham,Helvetica Neue,Helvetica,Arial,sans-serif",color:"#858585"},{}}),BoPattern.extend(function(a){"use strict";return a.BoTile=function(b){var c="background";if(!msngr.exist(b)||!msngr.exists(b.value,b.label,b.position))throw"[BoPattern.js] Invalid parameters supplied to BoTile";var d,e,f,g,h=!1,i=msngr.copy(b),j={},k=a.BoTooltip(),l=function(a){return 0>a?Math.ceil(a):Math.floor(a)},m=function(){var b=a.boundedWidth/a.data.maxFirstDimension,c=a.boundedHeight/(a.data.maxSecondDimension+1),d=a.boundedX1+b*i.position[0],e=a.boundedY1+c*i.position[1];return{x:d,y:e,width:b,height:c}},n=function(b){return void 0!==j[b]?j[b]:void 0!==i[b]?i[b]:a.BoTile.properties[b]},o={type:"tile",render:function(a){h&&(a.beginPath(),a.strokeStyle=n("borderColor"),a.lineWidth=n("borderThickness"),a.globalAlpha=n("borderAlpha"),a.strokeRect(n("x"),n("y"),n("width"),n("height")),a.closePath(),a.beginPath(),a.fillStyle=n("tileColor"),a.globalAlpha=n("tileAlpha"),a.fillRect(n("x"),n("y"),n("width"),n("height")),a.closePath())},update:function(){var b=!1;if(a.user.mousePosition.x>=i.x&&a.user.mousePosition.x<=i.x+i.width&&a.user.mousePosition.y>=i.y&&a.user.mousePosition.y<=i.y+i.height){if(e===!1){var h={x:n("x"),y:n("y"),absX:a.absoluteLeft+n("x"),absY:a.absoluteTop+n("y"),width:n("width"),height:n("height"),label:n("label")};a.trigger("hover",h),k.load(h)}e=!0,b=!0}if(b!==!0&&(e=!1,k.unload()),f!==a.screenWidth||g!==a.screenHeight){var l=m();i.x=l.x,i.y=l.y,i.width=l.width,i.height=l.height,void 0!==d&&(j.x=i.x,j.y=i.y,j.width=i.width,j.height=i.height),f=a.screenWidth,g=a.screenHeight}if(void 0!==d){if("loading"===d){if(j.tileAlpha>=i.tileAlpha)return d=void 0,void(j={});j.tileAlpha=j.tileAlpha+a.random(.02,.04)}if("unloading"===d){if(j.tileAlpha<=0)return d=void 0,j={},void a.objects[c].splice(a.objects[c].indexOf(o),1);j.tileAlpha=j.tileAlpha-a.random(.08,.12)}}},load:function(){d="loading",f=a.screenWidth,g=a.screenHeight;var b=m();i.x=b.x,i.y=b.y,i.width=b.width,i.height=b.height,i.value=l(i.value||0),0===a.data.maxValue||0===i.value?(i.tileAlpha=a.BoTile.properties.emptyTileAlpha,i.tileColor=a.BoTile.properties.emptyTileColor):(i.tileAlpha=i.value/a.data.maxValue,a.BoTile.properties.tileAlphaMinimum>i.tileAlpha&&(i.tileAlpha=a.BoTile.properties.tileAlphaMinimum)),j=msngr.copy(i),j.tileAlpha=0,h=!0},unload:function(){d="unloading",j=msngr.copy(i)}};return Object.defineProperty(o,"z",{get:function(){return c}}),Object.defineProperty(o,"properties",{get:function(){return i}}),o},a.BoTile.properties={tileColor:"#4DD2FF",tileAlpha:1,tileAlphaMinimum:.15,borderColor:"#FFFFFF",borderThickness:10,borderAlpha:1,borderHighlight:"#A3B3A3",emptyTileColor:"#888890",emptyTileAlpha:.356},{}}),BoPattern.extend(function(a){"use strict";var b={};return Object.defineProperty(b,"title",{get:function(){return a.title},set:function(b){msngr.isString(b)&&(a.title=b)}}),a.BoTitle=function(){var b="overlay",c=0,d=0,e={type:"botitle",render:function(b){b.beginPath(),b.font=a.BoTitle.properties.font,b.fillStyle=a.BoTitle.properties.color,b.globalAlpha=1,b.textAlign="left",b.fillText(a.label,c,d),b.closePath()},update:function(b){var e=b.measureText(a.label);c=a.screenWidth/2-e.width/2,d=a.boundedY1/2},load:function(){},unload:function(){a.objects[b].splice(a.objects[b].indexOf(e),1)}};return Object.defineProperty(e,"z",{get:function(){return b}}),e},a.BoTitle.properties={font:"16pt sans-serif",color:"#000000",alpha:1},b}),BoPattern.extend(function(a){"use strict";return a.BoXAxisLabel=function(b,c){var d,e,f,g="overlay",h=b,i=c,j={type:"boxaxislabel",render:function(b){e&&f&&(b.font=a.BoXAxisLabel.properties.font,b.textAlign="left",b.fillStyle=a.BoXAxisLabel.properties.color,b.fillText(h,e,f))},update:function(b){if(!msngr.isEmptyString(h)){d=b.measureText(h);var c=d.width,g=a.boundedWidth/a.data.xaxisLabelCount;e=a.boundedX1+(g*i+g/2)-c/2,e-=a.BoTile.properties.borderThickness/2,f=a.boundedY1+a.boundedHeight+a.BoXAxisLabel.properties.heightMargin}},load:function(){},unload:function(){a.objects[g].splice(a.objects[g].indexOf(j),1)}};return Object.defineProperty(j,"z",{get:function(){return z}}),j},a.BoXAxisLabel.properties={font:"12pt sans-serif",color:"#000000",heightMargin:20},{}}),BoPattern.extend(function(a){"use strict";return a.BoYAxisLabel=function(b,c){var d,e,f,g="overlay",h=b,i=c,j={type:"boyaxislabel",render:function(b){e&&f&&(b.font=a.BoYAxisLabel.properties.font,b.textAlign="left",b.fillStyle=a.BoYAxisLabel.properties.color,b.fillText(h,e,f))},update:function(b){if(!msngr.isEmptyString(h)){d=b.measureText(h);var c=d.width,g=a.boundedHeight/a.data.yaxisLabelCount,j=(a.screenWidth-a.boundedWidth)/2;e=j/2-c/2,f=a.boundedY1+g*i+g/2}},load:function(){},unload:function(){a.objects[g].splice(a.objects[g].indexOf(j),1)}};return Object.defineProperty(j,"z",{get:function(){return z}}),j},a.BoYAxisLabel.properties={font:"12pt sans-serif",color:"#000000"},{}}),BoPattern.extend(function(a){"use strict";return a.BoTooltip=function(){var b,c,d,e,f,g,h="foreground",i=0,j=!1,k={type:"botooltip",render:function(h){h.beginPath(),h.globalAlpha=i,h.strokeStyle=a.BoTooltip.properties.backgroundStrokeColor,h.lineWidth=a.BoTooltip.properties.backgroundStrokeThickness,h.fillStyle=a.BoTooltip.properties.backgroundColor,a.utils.fillRoundRect(h,e-6,f,1.5*b+6,55,5),h.closePath(),h.beginPath(),h.font=a.BoTitle.properties.font,h.fillStyle=a.BoTooltip.properties.color,h.globalAlpha=i,h.fillText(g.label,c,d),h.closePath()},update:function(h){var j=h.measureText(g.label);b=j.width,c=g.x+g.width/2-b/2-a.BoTile.properties.borderThickness/2,d=g.y-a.BoTile.properties.borderThickness,e=c,f=g.y-45,1>i&&(i+=.1)},load:function(b){i=1,a.addObject(h,k),j=!0,g=b},unload:function(){j===!0&&(j=!1,i=0,a.objects[h].splice(a.objects[h].indexOf(k),1))}};return Object.defineProperty(k,"z",{get:function(){return h}}),k},a.BoTooltip.properties={font:"11px sans-serif",color:"#FFFFEE",backgroundColor:"#232323",backgroundStrokeThickness:1,backgroundStrokeColor:"#FFFFFF"},{}}),BoPattern.extend(function(a){"use strict";return a.utils.fillRoundRect=function(a,b,c,d,e,f){var g={tl:f||0,tr:f||0,br:f||0,bl:f||0};a.beginPath(),a.moveTo(b+g.tl,c),a.lineTo(b+d-g.tr,c),a.quadraticCurveTo(b+d,c,b+d,c+g.tr),a.lineTo(b+d,c+e-g.br),a.quadraticCurveTo(b+d,c+e,b+d-g.br,c+e),a.lineTo(b+g.bl,c+e),a.quadraticCurveTo(b,c+e,b,c+e-g.bl),a.lineTo(b,c+g.tl),a.quadraticCurveTo(b,c,b+g.tl,c),a.closePath(),a.fill(),a.stroke()},{}}),BoPattern.extend(function(a){"use strict";return{load:function(b,c){if(msngr.exist(b)){var d=b.slice(0),e=msngr.copy(c)||{};void 0===e.labels&&(e.labels={xaxis:[],yaxis:[]}),e.labels.xaxis=e.labels.xaxis||[],e.labels.yaxis=e.labels.yaxis||[],msngr.isArray(d)&&!msngr.isArray(d[0])&&void 0!==d[0]&&(d=[d],a.config.warnings===!0&&console.warn("Single dimension array passed into <instance>.load(). It was autocorrected."));for(var f=a.objects.background.length,g=0;f>g;++g)a.objects.background[g].unload();var h=function(){if(a.objects.background.length>0)setTimeout(h,5);else{for(var b=void 0,c=void 0,f=d.length,g=void 0,i=e.labels.xaxis.length,j=e.labels.yaxis.length,k=[],l=d.length,m=0;l>m;++m)for(var n=d[m].length,o=0;n>o;++o){var p=d[m][o];msngr.isObject(p)?(p.value=p.value||p.data||0,p.label=p.label||p.value.toFixed(2)):p={value:p,label:String(p)};var q=a.BoTile(msngr.merge(p,{position:[m,o]}));k.push(q),(void 0===b||p.value<b)&&(b=p.value),(void 0===c||p.value>c)&&(c=p.value),(void 0===g||o>g)&&(g=o)}a.clearObjects("background"),a.clearObjects("overlay","boempty"),a.clearObjects("overlay","boxaxislabel"),a.clearObjects("overlay","boyaxislabel"),void 0===g&&a.addObject("overlay",a.BoEmpty()),a.data.raw=d,a.stopRendering(),a.data.minValue=b,a.data.maxValue=c,a.data.maxFirstDimension=f,a.data.maxSecondDimension=g,a.data.xaxisLabelCount=i,a.data.yaxisLabelCount=j,a.objects.background=k;for(var m=0;m<e.labels.xaxis.length;++m)!function(b,c){a.addObject("overlay",a.BoXAxisLabel(b,c))}(e.labels.xaxis[m],m);for(var m=0;m<e.labels.yaxis.length;++m)!function(b,c){a.addObject("overlay",a.BoYAxisLabel(b,c))}(e.labels.yaxis[m],m);a.startRendering();for(var r=a.objects.background.length,m=0;r>m;++m)a.objects.background[m].load()}};h()}}}});