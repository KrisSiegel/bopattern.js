var BoPattern=function(){"use strict";var a=[],b=function(b,c){var d={label:"Pattern of Life",objects:{background:[],foreground:[],overlay:[]},debug:!1,user:{mousePosition:{x:0,y:0}},data:{},eventHandlers:{},config:msngr.merge({tooltip:{display:!0}},c)};if("undefined"==typeof window||"undefined"==typeof window.HTMLCanvasElement)throw"[BoPattern.js] Sorry but your browser doesn't support the canvas element!";if(!msngr.exist(b)||msngr.isEmptyString(b))throw"[BoPattern.js] Sorry but you supplied me with invalid input! What do you expect me to do with that!?";switch(msngr.getType(b)){case"[object String]":var e=msngr.findElement(b);"[object HTMLCanvasElement]"!==msngr.getType(e)?(d.canvas=document.createElement("canvas"),e.appendChild(d.canvas)):d.canvas=e;break;case"[object HTMLCanvasElement]":d.canvas=b;break;default:if(!msngr.isHtmlElement(b))throw"[BoPattern.js] Sorry but you supplied me with invalid input! What do you expect me to do with that!?";d.canvas=document.createElement("canvas"),b.appendChild(d.canvas)}if(d.context2D=d.canvas.getContext("2d"),Object.defineProperty(d,"pxRatio",{get:function(){var a=window.devicePixelRatio||1,b=d.context2D.backingStorePixelRatio||d.context2D.webkitBackingStorePixelRatio||d.context2D.mozBackingStorePixelRatio||d.context2D.msBackingStorePixelRatio||d.context2D.oBackingStorePixelRatio||1;return a/b}}),!msngr.exist(d.canvas)||!msngr.exist(d.context2D))throw"[BoPattern.js] Welp you passed the first set of validators but I still failed to get the canvas :(";d.parent=d.canvas.parentNode,Object.defineProperty(d,"zlevels",{get:function(){return Object.keys(d.objects)}}),d.random=function(a,b){return Math.random()*(b-a)+a},d.addObject=function(a,b){msngr.exist(b)&&msngr.exist(b.render)&&d.objects[a].push(b)},d.clearObjects=function(a,b){for(var c=0;c<d.objects[a].length;++c)(void 0===b||d.objects[a][c].type===b)&&d.objects[a][c].unload()};var f={};d.trigger=function(a,b){if(d.eventHandlers[a]&&d.eventHandlers[a].length>0)for(var c=0;c<d.eventHandlers[a].length;++c)d.eventHandlers[a][c](b)},d.on=function(a,b){void 0===d.eventHandlers[a]&&(d.eventHandlers[a]=[]),d.eventHandlers[a].push(b)},f.on=d.on,d.off=function(a,b){void 0!==d.eventHandlers[a]&&d.eventHandlers[a].splice(d.eventHandlers[a].indexOf(b),1)},f.off=d.off;for(var g=0;g<a.length;++g){var h=a[g];"[object Function]"===Object.prototype.toString.call(h)&&(h=h(d)),f=msngr.merge(h,f)}return Object.defineProperty(f,"debug",{set:function(a){d.debug=a,a===!0&&(d.clearObjects("overlay"),d.addObject("overlay",d.BoDebug()),Object.defineProperty(f,"internal",{configurable:!0,get:function(){return d}})),a===!1&&(d.clearObjects("overlay","bodebug"),delete f.internal)},get:function(){return d.debug}}),Object.defineProperty(f,"label",{get:function(){return d.label},set:function(a){d.label=a}}),Object.defineProperty(f,"config",{get:function(){return d.config},set:function(a){d.config=msngr.merge(d.config,a),d.trigger("configChanged",d.config)}}),d.addObject("overlay",d.BoEmpty()),d.addObject("overlay",d.BoTitle()),f.removeSelf=function(){d.clearObjects("background"),d.clearObjects("foreground"),d.clearObjects("overlay"),d.stopUpdating(),d.stopRendering(),delete f.load,d.parent.removeChild(d.canvas)},f};return b.extend=function(b){a.push(b)},b}();BoPattern.extend(function(a){"use strict";var b,c=function(b,c){for(var d=a.objects[b].length,e=0;d>e;++e)a.objects[b][e]&&(c.beginPath(),a.objects[b][e].render(c),c.closePath())},d=function(){var e=a.context2D;e.clearRect(0,0,a.canvas.width,a.canvas.height),c("background",e),c("foreground",e),c("overlay",e),b=window.requestAnimationFrame(d)};a.startRendering=function(){d()},a.stopRendering=function(){(window.cancelAnimationFrame||window.mozCancelAnimationFrame)(b)},document.addEventListener("visibilitychange",function(b){document.hidden?a.stopRendering():a.startRendering()}),a.startRendering()}),BoPattern.extend(function(a){"use strict";var b=function(b,c){for(var d=a.objects[b].length,e=0;d>e;++e)a.objects[b][e]&&a.objects[b][e].update(c)};a.canvas.addEventListener("mousemove",function(b){var c=a.canvas.getBoundingClientRect();a.user.mousePosition={x:b.clientX-c.left,y:b.clientY-c.top}});var c,d=function(){var e=a.context2D,f=a.pxRatio,g=a.parent.getBoundingClientRect().width,h=a.parent.getBoundingClientRect().height;(a.screenWidth!==g||a.screenHeight!==h)&&(a.canvas.width=g*f,a.canvas.style.width=g+"px",a.screenWidth=g,a.canvas.height=h*f,a.canvas.style.height=h+"px",a.screenHeight=h,e.setTransform(f,0,0,f,0,0),a.boundedWidth=a.screenWidth-.15*a.screenWidth,a.boundedHeight=a.screenHeight-.2*a.screenHeight,a.boundedX1=(a.screenWidth-a.boundedWidth)/2,a.boundedY1=(a.screenHeight-a.boundedHeight)/2+(a.screenHeight-a.boundedHeight)/2/2,a.absoluteLeft=a.canvas.offsetLeft,a.absoluteTop=a.canvas.offsetTop),b("background",e),b("foreground",e),b("overlay",e),c=window.requestAnimationFrame(d)};a.startUpdating=function(){d()},a.stopUpdating=function(){(window.cancelAnimationFrame||window.mozCancelAnimationFrame)(c)},a.startUpdating()}),BoPattern.extend(function(a){"use strict";return a.BoDebug=function(){var b="overlay",c={mouse:{},tiles:{},data:{}},d=!1,e={type:"bodebug",render:function(b){d&&(b.beginPath(),b.font=a.BoDebug.properties.font,b.fillStyle=a.BoDebug.properties.color,b.globalAlpha=a.BoDebug.properties.textAlpha,b.textAlign="left",b.fillText(c.tiles.txt,c.tiles.x,c.tiles.y),b.fillText(c.data.txt,c.data.x,c.data.y),b.textAlign="center",b.fillText(c.mouse.txt,c.mouse.x,c.mouse.y),b.closePath()),b.beginPath(),b.strokeStyle=a.BoDebug.properties.borderColor,b.globalAlpha=a.BoDebug.properties.borderAlpha,b.lineWidth=a.BoDebug.properties.borderThickness,b.strokeRect(a.boundedX1,a.boundedY1,a.boundedWidth,a.boundedHeight),b.closePath()},update:function(b){c.mouse.txt="X: "+Math.floor(a.user.mousePosition.x)+" Y: "+Math.floor(a.user.mousePosition.y);var e=b.measureText(c.mouse.txt);c.mouse.x=a.screenWidth-e.width,c.mouse.y=15,c.tiles.txt="Tile count: "+a.objects.background.length,c.tiles.x=2,c.tiles.y=15,c.data.txt="min value: "+Math.round(a.data.minValue)+" / max value: "+Math.round(a.data.maxValue),c.data.x=2,c.data.y=30,d=!0},load:function(){},unload:function(){a.objects[b].splice(a.objects[b].indexOf(e),1)}};return e},a.BoDebug.properties={font:"10pt Sans-serif",color:"#000000",textAlpha:1,borderColor:"#000000",borderAlpha:1,borderThickness:1},{}}),BoPattern.extend(function(a){"use strict";return a.BoEmpty=function(){var b,c,d,e="overlay",f="I have no data to display :(",g={type:"boempty",render:function(b){c&&d&&(b.font=a.BoEmpty.properties.font,b.fillStyle=a.BoEmpty.properties.color,b.fillText(f,c,d))},update:function(e){b=e.measureText(f),c=a.screenWidth/2-b.width,d=a.screenHeight/2-b.height},load:function(){},unload:function(){a.objects[e].splice(a.objects[e].indexOf(g),1)}};return Object.defineProperty(g,"z",{get:function(){return z}}),g},a.BoEmpty.properties={font:"16pt Calibri",color:"#000000"},{}}),BoPattern.extend(function(a){"use strict";return a.BoTile=function(b){var c="background";if(!msngr.exist(b)||!msngr.exists(b.value,b.label,b.position))throw"[BoPattern.js] Invalid parameters supplied to BoTile";var d,e,f,g,h=!1,i=msngr.copy(b),j={},k=function(){var b=a.boundedWidth/a.data.maxFirstDimension,c=a.boundedHeight/(a.data.maxSecondDimension+1),d=a.boundedX1+b*i.position[0],e=a.boundedY1+c*i.position[1];return{x:d,y:e,width:b,height:c}},l=function(b){return void 0!==j[b]?j[b]:void 0!==i[b]?i[b]:a.BoTile.properties[b]},m={type:"tile",render:function(a){h&&(a.beginPath(),a.strokeStyle=l("borderColor"),a.lineWidth=l("borderThickness"),a.globalAlpha=l("borderAlpha"),a.strokeRect(l("x"),l("y"),l("width"),l("height")),a.closePath(),a.beginPath(),a.fillStyle=l("tileColor"),a.globalAlpha=l("tileAlpha"),a.fillRect(l("x"),l("y"),l("width"),l("height")),a.closePath())},update:function(){var b=!1;if(a.user.mousePosition.x>=i.x&&a.user.mousePosition.x<=i.x+i.width&&a.user.mousePosition.y>=i.y&&a.user.mousePosition.y<=i.y+i.height&&(e===!1&&a.trigger("hover",{x:l("x"),y:l("y"),absX:a.absoluteLeft+l("x"),absY:a.absoluteTop+l("y"),width:l("width"),height:l("height"),label:l("label")}),e=!0,b=!0),b!==!0&&(e=!1),f!==a.screenWidth||g!==a.screenHeight){var h=k();i.x=h.x,i.y=h.y,i.width=h.width,i.height=h.height,void 0!==d&&(j.x=i.x,j.y=i.y,j.width=i.width,j.height=i.height),f=a.screenWidth,g=a.screenHeight}if(void 0!==d){if("loading"===d){if(j.tileAlpha>=i.tileAlpha)return d=void 0,void(j={});j.tileAlpha=j.tileAlpha+a.random(.02,.04)}if("unloading"===d){if(j.tileAlpha<=0)return d=void 0,j={},void a.objects[c].splice(a.objects[c].indexOf(m),1);j.tileAlpha=j.tileAlpha-a.random(.08,.12)}}},load:function(){d="loading",f=a.screenWidth,g=a.screenHeight;var b=k();i.x=b.x,i.y=b.y,i.width=b.width,i.height=b.height,0===a.data.maxValue?i.tileAlpha=0:i.tileAlpha=i.value/a.data.maxValue,j=msngr.copy(i),j.tileAlpha=0,h=!0},unload:function(){d="unloading",j=msngr.copy(i)}};return Object.defineProperty(m,"z",{get:function(){return c}}),Object.defineProperty(m,"properties",{get:function(){return i}}),m},a.BoTile.properties={tileColor:"#4DD2FF",tileAlpha:1,borderColor:"#FFFFFF",borderThickness:10,borderAlpha:1,borderHighlight:"#A3B3A3"},{}}),BoPattern.extend(function(a){"use strict";var b={};return Object.defineProperty(b,"title",{get:function(){return a.title},set:function(b){msngr.isString(b)&&(a.title=b)}}),a.BoTitle=function(){var b="overlay",c=0,d=0,e={type:"botitle",render:function(b){b.beginPath(),b.font=a.BoTitle.properties.font,b.fillStyle=a.BoTitle.properties.color,b.globalAlpha=1,b.textAlign="left",b.fillText(a.label,c,d),b.closePath()},update:function(b){var e=b.measureText(a.label);c=a.screenWidth/2-e.width,d=a.boundedY1/2},load:function(){},unload:function(){a.objects[b].splice(a.objects[b].indexOf(e),1)}};return Object.defineProperty(e,"z",{get:function(){return b}}),e},a.BoTitle.properties={font:"16pt sans-serif",color:"#000000",alpha:1},b}),BoPattern.extend(function(a){"use strict";return{load:function(b){if(msngr.exist(b)){for(var c=a.objects.background.length,d=0;c>d;++d)a.objects.background[d].unload();var e=function(){if(a.objects.background.length>0)setTimeout(e,5);else{for(var c=void 0,d=void 0,f=b.length,g=void 0,h=[],i=b.length,j=0;i>j;++j)for(var k=b[j].length,l=0;k>l;++l){var m=b[j][l];msngr.isObject(m)?(m.value=m.value||m.data,m.label=m.label||m.value.toFixed(2),delete m.data):m={value:m,label:String(m)};var n=a.BoTile(msngr.merge(m,{position:[j,l]}));h.push(n),(void 0===c||m.value<c)&&(c=m.value),(void 0===d||m.value>d)&&(d=m.value),(void 0===g||l>g)&&(g=l)}a.clearObjects("background"),a.data.raw=b,a.stopUpdating(),a.stopRendering(),a.data.minValue=c,a.data.maxValue=d,a.data.maxFirstDimension=f,a.data.maxSecondDimension=g,a.objects.background=h,a.startUpdating(),a.startRendering();for(var o=a.objects.background.length,j=0;o>j;++j)a.objects.background[j].load()}};e()}}}});